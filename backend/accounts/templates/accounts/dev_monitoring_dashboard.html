<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resee ê°œë°œìš© ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .dev-banner {
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0;
            color: #333;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status.healthy {
            background-color: #d4edda;
            color: #155724;
        }
        .status.warning {
            background-color: #fff3cd;
            color: #856404;
        }
        .status.critical {
            background-color: #f8d7da;
            color: #721c24;
        }
        .metric {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .metric-label {
            font-weight: bold;
            color: #666;
        }
        .metric-value {
            font-size: 18px;
            color: #333;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .refresh-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
        .refresh-btn:hover {
            background-color: #0056b3;
        }
        .log-entry {
            background-color: #f8f9fa;
            border-left: 4px solid #dee2e6;
            padding: 8px 12px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry.error {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        .dev-note {
            background-color: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="dev-banner">
        ğŸš§ ê°œë°œ í™˜ê²½ ì „ìš© ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ - ì¸ì¦ ì—†ì´ ì ‘ê·¼ ê°€ëŠ¥ ğŸš§
    </div>

    <div class="header">
        <h1>ğŸ”§ Resee ê°œë°œìš© ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
            <span id="last-updated">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ë¡œë”© ì¤‘...</span>
            <div>
                <a href="/dev/logs/" style="background-color: #28a745; color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; margin-right: 10px;">ğŸ“‹ ë¡œê·¸ ë·°ì–´</a>
                <button class="refresh-btn" onclick="loadDashboardData()">ìƒˆë¡œê³ ì¹¨</button>
            </div>
        </div>
    </div>

    <div class="dev-note">
        <strong>ê°œë°œ í™˜ê²½ ì „ìš©:</strong> ì´ ëŒ€ì‹œë³´ë“œëŠ” DEBUG=Trueì¼ ë•Œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë©°, í”„ë¡œë•ì…˜ì—ì„œëŠ” ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
        ë¡œê·¸ ì ‘ê·¼ì´ ì œí•œë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì •ìƒì ì¸ ë™ì‘ì…ë‹ˆë‹¤.
    </div>

    <div class="grid">
        <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
        <div class="card">
            <h3>ğŸš€ ì‹œìŠ¤í…œ ìƒíƒœ</h3>
            <div id="system-status" class="loading">
                ë¡œë”© ì¤‘...
            </div>
        </div>

        <!-- ì„œë¹„ìŠ¤ ìƒíƒœ -->
        <div class="card">
            <h3>âš™ï¸ ì„œë¹„ìŠ¤ ìƒíƒœ</h3>
            <div id="services-status" class="loading">
                ë¡œë”© ì¤‘...
            </div>
        </div>

        <!-- ë¡œê·¸ í˜„í™© -->
        <div class="card">
            <h3>ğŸ“‹ ë¡œê·¸ í˜„í™©</h3>
            <div id="log-status" class="loading">
                ë¡œë”© ì¤‘...
            </div>
        </div>

        <!-- ìµœê·¼ ì—ëŸ¬ -->
        <div class="card">
            <h3>âš ï¸ ìµœê·¼ ì—ëŸ¬</h3>
            <div id="recent-errors" class="loading">
                ë¡œë”© ì¤‘...
            </div>
        </div>
    </div>

    <script>
        function formatTimestamp(timestamp) {
            return new Date(timestamp * 1000).toLocaleString('ko-KR');
        }

        function getStatusClass(status) {
            if (status === 'healthy') return 'healthy';
            if (status === 'warning') return 'warning';
            if (status === 'critical' || status === 'unhealthy' || status === 'degraded') return 'critical';
            return 'warning';
        }

        function loadDashboardData() {
            fetch('/dev/dashboard-data/')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }

                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
                document.getElementById('last-updated').textContent =
                    'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ' + formatTimestamp(data.timestamp) + ' (ê°œë°œ í™˜ê²½)';

                // ì‹œìŠ¤í…œ ì „ì²´ ìƒíƒœ
                const systemStatus = document.getElementById('system-status');
                const overallStatus = data.health.status || 'unknown';
                systemStatus.innerHTML = `
                    <div class="metric">
                        <div class="metric-label">ì „ì²´ ìƒíƒœ</div>
                        <div class="metric-value">
                            <span class="status ${getStatusClass(overallStatus)}">${overallStatus}</span>
                        </div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">ì‘ë‹µ ì‹œê°„</div>
                        <div class="metric-value">${data.health.total_response_time_ms || 0}ms</div>
                    </div>
                    <div class="dev-note">
                        <small>í™˜ê²½: ${data.environment || 'unknown'}</small>
                    </div>
                `;

                // ê°œë³„ ì„œë¹„ìŠ¤ ìƒíƒœ
                const servicesStatus = document.getElementById('services-status');
                let servicesHtml = '';

                if (data.health.services) {
                    Object.entries(data.health.services).forEach(([service, info]) => {
                        servicesHtml += `
                            <div class="metric">
                                <div class="metric-label">${service.toUpperCase()}</div>
                                <div class="metric-value">
                                    <span class="status ${getStatusClass(info.status)}">${info.status}</span>
                                    ${info.response_time_ms ? `<small>(${info.response_time_ms}ms)</small>` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
                servicesStatus.innerHTML = servicesHtml || 'ì„œë¹„ìŠ¤ ì •ë³´ ì—†ìŒ';

                // ë¡œê·¸ í˜„í™©
                const logStatus = document.getElementById('log-status');
                if (data.logs.status === 'success') {
                    logStatus.innerHTML = `
                        <div class="metric">
                            <div class="metric-label">ë¡œê·¸ íŒŒì¼ ìˆ˜</div>
                            <div class="metric-value">${data.logs.total_files || 0}ê°œ</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">ì´ í¬ê¸°</div>
                            <div class="metric-value">${data.logs.total_size_mb || 0}MB</div>
                        </div>
                    `;
                } else {
                    logStatus.innerHTML = `
                        <div class="dev-note">
                            ë¡œê·¸ ì ‘ê·¼ ì œí•œ: ${data.logs.message || 'ë¡œê·¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'}
                        </div>
                    `;
                }

                // ìµœê·¼ ì—ëŸ¬
                const recentErrors = document.getElementById('recent-errors');
                if (data.recent_errors.status === 'success' && data.recent_errors.errors) {
                    const errors = data.recent_errors.errors.slice(0, 5);
                    let errorsHtml = `<div class="metric-label">ìµœê·¼ ${data.recent_errors.hours_searched}ì‹œê°„ ë‚´ ì—ëŸ¬: ${data.recent_errors.error_count}ê°œ</div>`;

                    if (errors.length > 0) {
                        errors.forEach(error => {
                            errorsHtml += `
                                <div class="log-entry error">
                                    <strong>${error.level}</strong> ${formatTimestamp(new Date(error.timestamp).getTime() / 1000)}<br>
                                    ${error.message.substring(0, 100)}${error.message.length > 100 ? '...' : ''}
                                </div>
                            `;
                        });
                    } else {
                        errorsHtml += '<div style="color: #28a745; font-weight: bold;">âœ… ìµœê·¼ ì—ëŸ¬ ì—†ìŒ</div>';
                    }
                    recentErrors.innerHTML = errorsHtml;
                } else {
                    recentErrors.innerHTML = `
                        <div class="dev-note">
                            ì—ëŸ¬ ë¡œê·¸ ì ‘ê·¼ ì œí•œ: ${data.recent_errors.message || 'ì—ëŸ¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'}
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error loading dashboard data:', error);
                document.getElementById('system-status').innerHTML =
                    '<div class="error">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message + '</div>';
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadDashboardData);

        // 30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(loadDashboardData, 30000);
    </script>
</body>
</html>