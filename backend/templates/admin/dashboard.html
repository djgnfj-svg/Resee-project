{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:"Django site admin" }}{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <style>
        .dashboard-container {
            padding: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .metric-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: bold;
            color: #666;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 12px;
            margin-left: 5px;
        }

        .metric-change.positive {
            color: #28a745;
        }

        .metric-change.negative {
            color: #dc3545;
        }

        .metric-subtitle {
            font-size: 12px;
            color: #999;
        }

        .dashboard-section {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .activity-item, .alert-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child, .alert-item:last-child {
            border-bottom: none;
        }

        .activity-type, .alert-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .activity-type {
            background: #e3f2fd;
            color: #1976d2;
        }

        .alert-type.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .alert-type.warning {
            background: #fff3e0;
            color: #f57c00;
        }

        .alert-type.error {
            background: #ffebee;
            color: #d32f2f;
        }

        .timestamp {
            font-size: 11px;
            color: #999;
        }

        .tier-distribution {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tier-item {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            min-width: 80px;
        }

        .tier-count {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .tier-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s ease;
        }

        .top-users {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .user-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .user-item {
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .refresh-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .refresh-button:hover {
            background: #005a87;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.online {
            background-color: #28a745;
        }

        .status-indicator.warning {
            background-color: #ffc107;
        }

        .status-indicator.offline {
            background-color: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .system-health-details {
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid #f0f0f0;
        }


        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .top-users {
                grid-template-columns: 1fr;
            }
        }
    </style>
{% endblock %}

{% block content %}

<div class="dashboard-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Resee Admin Dashboard</h1>
        <button class="refresh-button" onclick="refreshDashboard()">Refresh Data</button>
    </div>

    <!-- Key Metrics -->
    <div class="metrics-grid">
        <!-- User Metrics -->
        <div class="metric-card">
            <h3>Total Users</h3>
            <div class="metric-value">{{ user_metrics.total_users|default:0 }}</div>
            <div class="metric-subtitle">
                {{ user_metrics.new_week|default:0 }} new users this week
                <br>{{ user_metrics.verified_rate|floatformat:1 }}% verified
            </div>
        </div>

        <!-- Content Metrics -->
        <div class="metric-card">
            <h3>Total Content</h3>
            <div class="metric-value">{{ content_metrics.total_content|default:0 }}</div>
            <div class="metric-subtitle">
                {{ content_metrics.content_week|default:0 }} created this week
                <br>{{ content_metrics.total_reviews|default:0 }} total reviews
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="dashboard-section">
        <div class="section-title">Recent Activity</div>
        {% for activity in recent_activity %}
        <div class="activity-item">
            <div>
                <span class="activity-type">{{ activity.type }}</span>
                <span class="ml-2">{{ activity.description }}</span>
            </div>
            <div class="timestamp">{{ activity.timestamp|date:"M d, H:i" }}</div>
        </div>
        {% empty %}
        <p class="text-muted">No recent activity</p>
        {% endfor %}
    </div>

    <!-- Quick Actions -->
    <div class="dashboard-section">
        <div class="section-title">Quick Actions</div>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="{% url 'admin:accounts_user_changelist' %}" class="btn btn-primary">Manage Users</a>
            <a href="{% url 'admin:accounts_subscription_changelist' %}" class="btn btn-secondary">Manage Subscriptions</a>
            <a href="{% url 'admin:content_content_changelist' %}" class="btn btn-secondary">Manage Content</a>
            <a href="{% url 'admin:review_reviewschedule_changelist' %}" class="btn btn-secondary">Review Schedules</a>
            <a href="{% url 'admin:review_reviewhistory_changelist' %}" class="btn btn-secondary">Review History</a>
        </div>
    </div>
</div>

<script>
// Simple refresh function
function refreshDashboard() {
    window.location.reload();
}
</script>
{% endblock %}