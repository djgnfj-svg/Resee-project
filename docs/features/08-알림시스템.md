# 알림 시스템

## 핵심 개념

**이메일 리마인더**로 복습 시간을 자동으로 알려줍니다.
사용자가 설정한 시간에 Celery Beat가 이메일을 발송하며, 언제든지 수신 거부할 수 있습니다.

## 주요 기능

- **복습 리마인더**:
  - 일일 알림 (사용자 설정 시간)
  - 저녁 알림 (선택적)
- **개인화된 이메일**:
  - 복습 개수
  - 오늘의 복습 목록
- **수신 설정**:
  - 알림 on/off 설정
  - 안전한 수신 거부 링크 (64자 토큰)
- **자동 발송**: Celery Beat 스케줄러

## 동작 흐름

```
1. Celery Beat가 설정된 시간에 작업 실행
   ↓
2. 오늘 복습이 있고 알림 활성화된 사용자 조회
   ↓
3. 사용자별 복습 목록 생성
   ↓
4. 이메일 발송 (Gmail SMTP)
   ↓
5. 수신 거부 링크 포함
```

## API

- `GET /api/accounts/notification-preferences/` - 알림 설정 조회
- `PUT /api/accounts/notification-preferences/` - 알림 설정 변경
- `POST /api/accounts/unsubscribe/` - 수신 거부 (토큰)

## 관련 파일

- `backend/review/tasks.py` - Celery 이메일 작업
- `backend/accounts/models.py` - NotificationPreference 모델
- `backend/accounts/email/email_service.py` - 이메일 발송
- `backend/resee/celery.py` - Celery Beat 스케줄 설정

## 스케줄 설정

```python
# Celery Beat 스케줄
CELERY_BEAT_SCHEDULE = {
    'send-review-reminders': {
        'task': 'review.tasks.send_review_reminders',
        'schedule': crontab(hour=9, minute=0),  # 매일 오전 9시
    }
}
```

## 환경 변수

```bash
# .env
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
```
