# 시스템 모니터링

## 핵심 개념

**헬스 체크, 로그 관리, Slack 알림**으로 시스템 상태를 실시간으로 모니터링합니다.
문제 발생 시 즉시 감지하고 대응할 수 있습니다.

## 주요 기능

### 헬스 체크
- **기본 체크**: DB 연결 확인
- **상세 체크**: PostgreSQL, Redis, Celery, 디스크 용량
- **Readiness/Liveness**: 쿠버네티스/로드밸런서용

### 로그 관리 (관리자 전용)
- 로그 요약 조회
- 최근 에러 필터링
- 로그 파일 내용 조회
- 오래된 로그 자동 정리

### Slack 알림 (9+ 트리거)
- DB/Redis 연결 실패
- 디스크 용량 부족 (>80%)
- Celery 작업 실패
- 백업 실패/성공
- 결제 실패
- API 응답 지연 (>2초)
- 에러율 급증 (>10/분)

## 동작 흐름

```
[헬스 체크]
1. 로드밸런서가 /api/health/ 호출
   ↓
2. DB 연결 테스트
   ↓
3. OK(200) 또는 ERROR(503) 응답

[Slack 알림]
1. 문제 감지 (예: DB 연결 실패)
   ↓
2. SlackNotifier.send() 호출
   ↓
3. Webhook으로 메시지 전송
   ↓
4. 담당자 즉시 확인
```

## API

- `GET /api/health/` - 기본 헬스 체크
- `GET /api/health/detailed/` - 상세 시스템 상태
- `GET /api/health/ready/` - Readiness 체크
- `GET /api/health/live/` - Liveness 체크
- `GET /api/accounts/logs/summary/` - 로그 요약 (관리자)
- `GET /api/accounts/logs/errors/` - 최근 에러 (관리자)
- `GET /api/accounts/dashboard-data/` - 모니터링 대시보드

## 관련 파일

- `backend/accounts/health/health_views.py` - 헬스 체크
- `backend/accounts/health/log_views.py` - 로그 관리
- `backend/utils/slack_notifications.py` - Slack 알림
- `backend/utils/monitoring.py` - 메트릭 수집
- `backend/resee/structured_logging.py` - JSON 로깅

## 로그 구조

```python
# 4개의 로그 파일
logs/
├── django.log      # 일반 로그
├── celery.log      # Celery 작업
├── security.log    # 인증/권한
└── error.log       # 에러만
```

## 환경 변수

```bash
# .env
SLACK_WEBHOOK_URL=https://hooks.slack.com/...
SLACK_DEFAULT_CHANNEL=#alerts
```
