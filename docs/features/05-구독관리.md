# 구독 관리

## 핵심 개념

**3단계 구독 등급** (FREE/BASIC/PRO)으로 차별화된 복습 간격을 제공합니다.
Toss Payments 연동으로 안전한 결제를 지원하지만, 현재는 FREE 등급만 운영 중입니다.

## 주요 기능

### 등급별 복습 간격
- **FREE**: 1, 3일 (2단계)
- **BASIC**: 1, 3, 7, 14, 30, 60, 90일 (7단계)
- **PRO**: 1, 3, 7, 14, 30, 60, 120, 180일 (8단계)

### 구독 기능
- 등급 업그레이드/다운그레이드
- 구독 취소
- 자동 갱신 설정
- 결제 이력 조회
- 청구 일정 확인

## 동작 흐름

```
1. 사용자가 구독 페이지 접속
   ↓
2. 등급 선택 (FREE는 무료)
   ↓
3. BASIC/PRO 선택 시:
   - 결제 페이지 이동 (현재 비활성화)
   - Toss Payment Widget 연동
   ↓
4. 결제 완료 → 등급 업그레이드
   ↓
5. 자동 갱신 또는 수동 취소
```

## API

- `GET /api/accounts/subscription/` - 현재 구독 정보
- `GET /api/accounts/subscription/tiers/` - 등급 목록
- `POST /api/accounts/subscription/upgrade/` - 업그레이드
- `POST /api/accounts/subscription/downgrade/` - 다운그레이드
- `POST /api/accounts/subscription/cancel/` - 취소
- `POST /api/accounts/subscription/toggle-auto-renewal/` - 자동 갱신
- `GET /api/accounts/payment-history/` - 결제 이력
- `GET /api/accounts/billing-schedule/` - 청구 일정

## 관련 파일

- `backend/accounts/subscription/subscription_views.py` - 구독 API
- `backend/accounts/subscription/toss_service.py` - Toss Payments 연동
- `backend/accounts/subscription/billing_service.py` - 청구 자동화
- `backend/accounts/subscription/services.py` - 권한 검증
- `frontend/src/pages/SubscriptionPage.tsx` - 구독 UI
- `frontend/src/pages/CheckoutPage.tsx` - 결제 UI

## 권한 검증

```python
# 등급별 복습 간격 제한
@has_subscription_permission
def submit_review(request):
    user_tier = request.user.subscription.tier
    max_interval = TIER_LIMITS[user_tier]
    # interval_index < max_interval 체크
```

## 현재 상태

Toss Payments 연동은 구현되었으나 **현재 FREE 등급만 운영** 중입니다.
