# 인증 시스템

## 📌 핵심 개념

**JWT(JSON Web Token)** 기반 무상태 인증으로 보안성과 확장성을 동시에 확보했습니다.
이메일 인증을 통해 실제 사용자만 서비스를 이용할 수 있습니다.

## ✨ 주요 기능

- **JWT 토큰 인증**: Access Token (30분) + Refresh Token (7일)
- **이메일 인증**: SHA-256 해시 토큰으로 안전한 이메일 확인
- **Google OAuth**: 구글 계정으로 간편 로그인
- **자동 토큰 갱신**: Access Token 만료 시 자동 Refresh
- **보안 강화**:
  - 토큰은 메모리에만 저장 (localStorage 사용 안 함)
  - 상수 시간 비교로 타이밍 공격 방지

## 🔄 동작 흐름

```
[회원가입]
1. 이메일, 비밀번호 입력
   ↓
2. 인증 메일 발송 (SHA-256 토큰)
   ↓
3. 링크 클릭 → 이메일 인증 완료
   ↓
4. 로그인 가능

[로그인]
1. 이메일, 비밀번호 입력
   ↓
2. Access + Refresh 토큰 발급
   ↓
3. 토큰을 메모리에 저장
   ↓
4. API 요청 시 자동으로 헤더에 추가
```

## 🔗 API

- `POST /api/accounts/users/` - 회원가입
- `POST /api/auth/token/` - 로그인 (JWT 발급)
- `POST /api/auth/token/refresh/` - Access Token 갱신
- `POST /api/accounts/verify-email/` - 이메일 인증
- `POST /api/accounts/resend-verification/` - 인증 메일 재발송
- `POST /api/accounts/google-oauth/` - Google OAuth 로그인

## 📁 관련 파일

- `backend/accounts/auth/views.py` - 인증 API
- `backend/accounts/auth/middleware.py` - JWT 미들웨어
- `backend/accounts/email/email_views.py` - 이메일 인증
- `frontend/src/utils/api.ts` - JWT 인터셉터 (자동 갱신)
- `frontend/src/contexts/AuthContext.tsx` - 인증 상태 관리

## 💡 보안 로직

```python
# 이메일 인증 토큰 생성 (SHA-256)
token = hashlib.sha256(f"{user.email}{timezone.now()}".encode()).hexdigest()

# 상수 시간 비교 (타이밍 공격 방지)
is_valid = secrets.compare_digest(stored_token, provided_token)
```
