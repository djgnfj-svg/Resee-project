# 보안 & 성능

## 핵심 개념

**Redis 기반 Rate Limiting**과 **프론트엔드 최적화**로 보안과 성능을 동시에 확보했습니다.
악의적인 요청을 차단하고, 사용자 경험을 향상시킵니다.

## 주요 기능

### 보안
- **Redis Rate Limiting**:
  - 익명: 100 req/hr
  - 인증: 1000 req/hr
  - 로그인: 5 req/min
  - 회원가입: 3 req/min
- **보안 헤더**:
  - XSS Protection
  - HSTS (max-age: 31536000)
  - X-Frame-Options: DENY
  - Content-Type-Nosniff
- **CSRF 보호**: 상태 변경 요청에 토큰 필수

### 성능
- **프론트엔드**:
  - React.lazy 코드 스플리팅 (21 페이지)
  - Tree shaking (번들 크기 최소화)
  - 254kB 메인 번들 + 27 lazy chunks
- **백엔드**:
  - DB 인덱싱 (ReviewSchedule: 3개, ReviewHistory: 4개)
  - select_related/prefetch_related
  - 캐싱 (Redis + locmem)

## 동작 흐름

```
[Rate Limiting]
1. 요청 수신
   ↓
2. Redis에서 IP/사용자별 요청 횟수 확인
   ↓
3. 제한 초과 시 429 에러 반환
   초과하지 않으면 요청 처리
   ↓
4. Redis 카운터 증가

[코드 스플리팅]
1. 사용자가 페이지 접속
   ↓
2. 해당 페이지 chunk만 로드
   ↓
3. LoadingFallback 표시
   ↓
4. 페이지 렌더링
```

## 관련 설정

```python
# Rate Limiting
REST_FRAMEWORK = {
    'DEFAULT_THROTTLE_CLASSES': [
        'resee.throttling.RedisAnonRateThrottle',
        'resee.throttling.RedisUserRateThrottle',
    ]
}

# 프론트엔드 (package.json)
{
  "sideEffects": ["*.css"],  # Tree shaking
}
```

## 관련 파일

- `backend/resee/throttling.py` - Redis Rate Limiting
- `backend/resee/middleware.py` - 보안 헤더
- `frontend/src/App.tsx` - React.lazy 설정
- `frontend/src/components/LoadingFallback.tsx` - 로딩 UI

## 성능 지표

```
번들 크기:
- 메인: 254kB (gzip)
- Lazy chunks: 27개

DB 인덱스:
- ReviewSchedule: user+date, date, user+active
- ReviewHistory: user+date, content, score
- Content: author+date, category+date

캐시:
- Redis: Rate limiting (50 connections)
- locmem: 일반 캐시 (5000 entries)
```
