graph TB
    subgraph Internet["ğŸŒ ì¸í„°ë„·"]
        Users["ì‚¬ìš©ì"]
    end

    subgraph CDN["Cloudflare CDN"]
        CF["SSL/TLS ì¢…ë‹¨<br/>DDoS ë³´í˜¸<br/>WAF"]
    end

    subgraph CICD["CI/CD íŒŒì´í”„ë¼ì¸"]
        GH["GitHub Repository"]
        Actions["GitHub Actions<br/>- í…ŒìŠ¤íŠ¸ ìë™í™”<br/>- ë¹Œë“œ<br/>- ë°°í¬"]
    end

    subgraph AWS["â˜ï¸ AWS Cloud - ap-northeast-2"]
        subgraph Network["ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ"]
            Route53["Route 53<br/>DNS ê´€ë¦¬"]
            ALB["Application Load Balancer<br/>- Health Check<br/>- SSL Offloading<br/>- Path-based Routing"]
        end

        subgraph VPC["VPC 10.0.0.0/16"]
            subgraph PublicSubnet["Public Subnet"]
                NAT["NAT Gateway<br/>ì•„ì›ƒë°”ìš´ë“œ ì „ìš©"]
            end

            subgraph PrivateSubnet["Private Subnet"]
                subgraph Compute["EC2 t3.medium"]
                    subgraph AppLayer["Application Layer"]
                        Nginx["Nginx 1.24<br/>- Reverse Proxy<br/>- SSL Termination<br/>- Rate Limiting"]
                        Django["Django 4.2<br/>+ Gunicorn<br/>1 worker, 2 threads"]
                        React["React 18<br/>Static Build<br/>Code Splitting"]
                    end

                    subgraph TaskQueue["Task Queue"]
                        Celery["Celery Worker<br/>- Email ë°œì†¡<br/>- DB ë°±ì—…<br/>- AI ìš”ì²­"]
                        Beat["Celery Beat<br/>ìŠ¤ì¼€ì¤„ëŸ¬"]
                    end

                    subgraph DataServices["Data Services"]
                        PG["PostgreSQL 15<br/>- WAL Archiving<br/>- Point-in-Time Recovery"]
                        RD["Redis 7<br/>- ìºì‹œ<br/>- ì„¸ì…˜<br/>- ë©”ì‹œì§€ ë¸Œë¡œì»¤"]
                    end
                end
            end

            subgraph Storage["ìŠ¤í† ë¦¬ì§€"]
                S3["S3 Bucket<br/>- DB ë°±ì—… (ì¼ì¼)<br/>- ì •ì  íŒŒì¼<br/>- ë¡œê·¸ ì•„ì¹´ì´ë¸Œ<br/>Lifecycle: 30ì¼â†’Glacier"]
            end
        end

        subgraph Monitoring["ëª¨ë‹ˆí„°ë§ & ë¡œê¹…"]
            CW["CloudWatch<br/>- ë©”íŠ¸ë¦­ ìˆ˜ì§‘<br/>- ë¡œê·¸ ì§‘ê³„<br/>- ì•ŒëŒ"]
            SNS["SNS Topics<br/>ì•ŒëŒ ë°œì†¡"]
        end

        subgraph Security["ë³´ì•ˆ"]
            SG["Security Groups<br/>- ALB: 80,443<br/>- EC2: 22,8000<br/>- DB: 5432"]
            IAM["IAM Roles<br/>- EC2â†’S3 ì ‘ê·¼<br/>- ìµœì†Œ ê¶Œí•œ ì›ì¹™"]
        end
    end

    subgraph External["ì™¸ë¶€ ì„œë¹„ìŠ¤"]
        Claude["Anthropic Claude API<br/>- Content Validation (Sonnet 3.5)<br/>- Answer Evaluation (Haiku 3)<br/>- Question Generation (Haiku 3)"]
        Gmail["Gmail SMTP<br/>ì´ë©”ì¼ ë°œì†¡"]
        Slack["Slack Webhooks<br/>ìš´ì˜ ì•Œë¦¼"]
    end

    %% ì‚¬ìš©ì í”Œë¡œìš°
    Users -->|HTTPS| CF
    CF -->|HTTPS| Route53
    Route53 --> ALB
    ALB --> Nginx

    %% CI/CD í”Œë¡œìš°
    GH --> Actions
    Actions -->|SSH ë°°í¬<br/>deploy.sh| Nginx
    Actions -.->|ì„±ê³µ/ì‹¤íŒ¨| Slack

    %% ì• í”Œë¦¬ì¼€ì´ì…˜ í”Œë¡œìš°
    Nginx -->|/api/*| Django
    Nginx -->|static/*| React

    Django --> PG
    Django --> RD
    Celery --> PG
    Celery --> RD
    Beat --> RD

    %% ì™¸ë¶€ ì—°ë™
    Django --> Claude
    Celery --> Claude
    Celery --> Gmail
    Django -.-> Slack

    %% ë°±ì—… & ìŠ¤í† ë¦¬ì§€
    Celery -.->|pg_dump<br/>ë§¤ì¼ 03:00| S3
    PG -.->|WAL Archive| S3

    %% ëª¨ë‹ˆí„°ë§
    Django -.->|ë¡œê·¸| CW
    Celery -.->|ë¡œê·¸| CW
    Nginx -.->|ì•¡ì„¸ìŠ¤ ë¡œê·¸| CW
    ALB -.->|ë©”íŠ¸ë¦­| CW
    CW -->|ì„ê³„ì¹˜ ì´ˆê³¼| SNS
    SNS --> Slack

    %% ë³´ì•ˆ
    SG -.->|ë°©í™”ë²½ ê·œì¹™| Compute
    IAM -.->|ê¶Œí•œ ë¶€ì—¬| Compute
    NAT -.->|ì•„ì›ƒë°”ìš´ë“œ| Django
    NAT -.->|ì•„ì›ƒë°”ìš´ë“œ| Celery

    %% ìŠ¤íƒ€ì¼ë§
    classDef internet fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#000
    classDef cdn fill:#F38020,stroke:#E65100,stroke-width:3px,color:#fff
    classDef aws fill:#FF9900,stroke:#E68900,stroke-width:2px,color:#000
    classDef compute fill:#FFE0B2,stroke:#F57C00,stroke-width:2px,color:#000
    classDef data fill:#BBDEFB,stroke:#1976D2,stroke-width:2px,color:#000
    classDef storage fill:#C8E6C9,stroke:#388E3C,stroke-width:2px,color:#000
    classDef monitor fill:#FFF9C4,stroke:#F9A825,stroke-width:2px,color:#000
    classDef security fill:#FFCDD2,stroke:#C62828,stroke-width:2px,color:#000
    classDef external fill:#E1BEE7,stroke:#7B1FA2,stroke-width:2px,color:#000
    classDef cicd fill:#B0BEC5,stroke:#455A64,stroke-width:2px,color:#000
    classDef app fill:#A5D6A7,stroke:#388E3C,stroke-width:2px,color:#000

    class Users internet
    class CF cdn
    class Route53,ALB,NAT aws
    class Nginx,Django,React,Celery,Beat app
    class PG,RD data
    class S3 storage
    class CW,SNS monitor
    class SG,IAM security
    class Claude,Gmail,Slack external
    class GH,Actions cicd
