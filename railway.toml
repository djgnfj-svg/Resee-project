# Backend Service (Django)
[[services]]
name = "backend"

[services.build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[services.deploy]
startCommand = "cd backend && gunicorn resee.wsgi:application --bind 0.0.0.0:8000 --workers 2 --threads 2 --timeout 120"
healthcheckPath = "/api/health/"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Celery Worker Service
[[services]]
name = "celery-worker"

[services.build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[services.deploy]
startCommand = "cd backend && celery -A resee worker -l info"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Celery Beat Service
[[services]]
name = "celery-beat"

[services.build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[services.deploy]
startCommand = "cd backend && celery -A resee beat -l info"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
